import os
import sched
import time
import threading
import json
import schedule
import requests
from datetime import datetime

now = datetime.now()

def time_():
  sec=time.time()
  local_time = time.ctime(sec)
  print("Local time:", local_time)


scheduler = sched.scheduler(time.time, time.sleep)

def notification(message):
    requests.post("https://ntfy.sivahomelab.online/4UyIRzBtfevKHJ1y", 
      data=message)

# def json_(log_obj):
#   with open("log_instagram.json", "w") as outfile:
#     outfile.write(log_obj)

class Person:
  def __init__(self, username,id_):
    self.username = username
    self.id=id_
    self.logid="--login "+id_

  def fulldownload(self):
    result = os.popen("instaloader --dirname-pattern=/root/storage {} {}".format(self.username,self.logid)).read()
    time_()
    print("1.fulldownload"+self.username)

  def profile(self):
    result = os.popen("instaloader --profile {} {}".format(self.username,self.logid)).read()
    time_()
    print("2.profile"+self.username)

  def fulldownload_laststamp(self):
    result = os.popen('instaloader --latest-stamps {} {}'.format(self.username,self.logid)).read()
    time_()
    print("3.laststamp"+self.username)

  def fulldownload_stories(self):
    #result = os.popen('echo "--stories" {} {}'.format(self.username,self.logid)).read()
    result = os.popen('instaloader --stories {} {}'.format(self.username,self.logid)).read()
    if "400 Bad Request" in error_message:
      message="400 Bad Request"
      notification(message)
    elif "401 Unauthorized" in error_message:
      message="401 Unauthorized"
      notification(message)
    else:
      print(f"Error occurred: {e}")   
    time_() 
    notification("5.highlight"+self.username)
    print('5.highlight'+self.username)
    time_()
    notification("4.story"+self.username)
    print("4.story"+self.username)

  def fulldownload_highlights(self):
    result = os.popen('instaloader --highlights {} {}'.format(self.username,self.logid)).read()
    
    if "400 Bad Request" in error_message:
      message="400 Bad Request"
      notification(message)
    elif "401 Unauthorized" in error_message:
      message="401 Unauthorized"
      notification(message)
    else:
      print(f"Error occurred: {e}")   
    time_() 
    notification("5.highlight"+self.username)
    print('5.highlight'+self.username)



  def fulldownload_tagged(self):
    result = os.popen('instaloader --tagged {} {}'.format(self.username,self.logid)).read()  
    time_()
    print('6.tag'+self.username)

  def fulldownload_geotags(self):
    result = os.popen('instaloader --geotags profile {} {}'.format(self.username,self.logid)).read() 
    time_()
    print('7.geo'+self.username)



def time_sheduler(person):
  person.fulldownload_stories()


def time_sheduler1(person):
  person.fulldownload_highlights()


list_=[p9,p10,p11,p3,p4,p5,p6,p12]


for i in list_:

  time_sheduler(i)
  time.sleep(300)
  time_sheduler1(i)
  time.sleep(300)



 



